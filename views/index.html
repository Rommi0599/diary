<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8">
  <title>ç”Ÿæ´»æ›¸å¯«å¹³å°</title>
  <style>
    body {
      font-family: 'Microsoft JhengHei', sans-serif;
      background: #f9f6f2;
      margin: 0;
      padding: 0;
    }

    .header-bar {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      padding: 1em 2em 0 2em;
      background: transparent;
    }

    .header-bar .tab-btn,
    .header-bar .logout-btn {
      background: #fff;
      border: 1px solid #ef8f8f;
      color: #ef8f8f;
      border-radius: 20px;
      padding: 0.5em 2em;
      margin-left: 1em;
      font-size: 1em;
      cursor: pointer;
      outline: none;
      transition: background 0.2s, color 0.2s;
      text-decoration: none;
      display: inline-block;
    }

    .header-bar .tab-btn:hover,
    .header-bar .logout-btn:hover {
      background: #ef8f8f;
      color: #fff;
    }

    .header-bar .user-info {
      color: #ef8f8f;
      font-weight: bold;
      margin-left: 1em;
      font-size: 1em;
    }

    .main-title {
      text-align: center;
      color: #ef8f8f;
      font-size: 2.5em;
      margin-top: 1.5em;
      margin-bottom: 1em;
      letter-spacing: 2px;
    }

    .tab-content {
      display: none;
      max-width: 350px;
      margin: 0 auto 2em auto;
      background: #fff;
      border-radius: 0 0 16px 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.07);
      padding: 2em 2em 1.5em 2em;
      position: relative;
      z-index: 2;
    }

    .tab-content.active {
      display: block;
    }

    .big-options {
      display: flex;
      justify-content: center;
      gap: 3em;
      margin: 2em 0 2em 0;
    }

    .big-option-btn {
      flex: 1 1 200px;
      background: #fff;
      border: 2px solid #ef8f8f;
      border-radius: 16px;
      color: #ef8f8f;
      font-size: 1.5em;
      font-weight: bold;
      padding: 2em 1em;
      margin: 0 1em;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(239, 143, 143, 0.07);
      transition: background 0.2s, color 0.2s, transform 0.15s;
      text-align: center;
      text-decoration: none;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .big-option-btn:hover {
      background: #ef8f8f;
      color: #fff;
      transform: translateY(-4px) scale(1.03);
    }

    .welcome-text {
      text-align: center;
      color: #888;
      margin-bottom: 2em;
      font-size: 1.1em;
    }

    @media (max-width: 700px) {
      .big-options {
        flex-direction: column;
        gap: 1.5em;
      }

      .big-option-btn {
        margin: 0;
        font-size: 1.2em;
        padding: 1.5em 0.5em;
      }
    }
  </style>
</head>

<body>
  <div class="header-bar" id="headerBar"></div>
  <div class="main-title">ç”Ÿæ´»æ›¸å¯«å¹³å°</div>
  <div class="tab-content active" id="loginTab">
    <form id="loginForm">
      <h3 style="text-align:center;color:#ef8f8f;">ç™»å…¥</h3>
      <input type="text" name="login_username" placeholder="å¸³è™Ÿ" style="width:100%;margin-bottom:1em;"><br>
      <input type="password" name="login_password" placeholder="å¯†ç¢¼" style="width:100%;margin-bottom:1em;"><br>
      <button type="submit" style="width:100%;">ç™»å…¥</button>
    </form>
  </div>
  <div class="tab-content" id="registerTab">
    <form id="registerForm">
      <h3 style="text-align:center;color:#ef8f8f;">è¨»å†Š</h3>
      <input type="text" name="reg_username" placeholder="å¸³è™Ÿ" style="width:100%;margin-bottom:1em;"><br>
      <input type="password" name="reg_password" placeholder="å¯†ç¢¼" style="width:100%;margin-bottom:1em;"><br>
      <button type="submit" style="width:100%;">è¨»å†Š</button>
    </form>
  </div>
  <div class="welcome-text">æ­¡è¿ä¾†åˆ°Rommiçš„ç”Ÿæ´»æ›¸å¯«å¹³å°ï¼</div>
  <div class="big-options">
    <a href="diary.html" class="big-option-btn">
      <span style="font-size:2em;">ğŸ“”</span>
      å€‹äººæ—¥è¨˜
    </a>
    <a href="blog.html" class="big-option-btn">
      <span style="font-size:2em;">ğŸ“</span>
      éƒ¨è½æ ¼
    </a>
  </div>
  <script>
    // å‹•æ…‹ç”¢ç”Ÿå³ä¸Šè§’ç™»å…¥/è¨»å†Šæˆ–å¸³è™Ÿ/ç™»å‡º
    function renderHeaderBar() {
      const headerBar = document.getElementById('headerBar');
      headerBar.innerHTML = '';
      const user_id = localStorage.getItem('user_id');
      const username = localStorage.getItem('username');
      if (user_id && username) {
        // å·²ç™»å…¥ï¼Œé¡¯ç¤ºå¸³è™Ÿèˆ‡ç™»å‡º
        const userInfo = document.createElement('span');
        userInfo.className = 'user-info';
        userInfo.textContent = `æ‚¨å¥½ï¼Œ${username}`;
        const logoutBtn = document.createElement('button');
        logoutBtn.className = 'logout-btn';
        logoutBtn.textContent = 'ç™»å‡º';
        logoutBtn.onclick = function () {
          localStorage.removeItem('user_id');
          localStorage.removeItem('username');
          localStorage.removeItem('is_admin');
          location.reload();
        };
        headerBar.appendChild(userInfo);
        headerBar.appendChild(logoutBtn);
      } else {
        // æœªç™»å…¥ï¼Œé¡¯ç¤ºç™»å…¥/è¨»å†Šï¼ˆåˆ†é åˆ‡æ›ï¼‰
        const loginTabBtn = document.createElement('button');
        loginTabBtn.className = 'tab-btn active';
        loginTabBtn.textContent = 'ç™»å…¥';
        loginTabBtn.onclick = function () {
          document.getElementById('loginTab').classList.add('active');
          document.getElementById('registerTab').classList.remove('active');
          loginTabBtn.classList.add('active');
          registerTabBtn.classList.remove('active');
        };
        const registerTabBtn = document.createElement('button');
        registerTabBtn.className = 'tab-btn';
        registerTabBtn.textContent = 'è¨»å†Š';
        registerTabBtn.onclick = function () {
          document.getElementById('loginTab').classList.remove('active');
          document.getElementById('registerTab').classList.add('active');
          loginTabBtn.classList.remove('active');
          registerTabBtn.classList.add('active');
        };
        headerBar.appendChild(loginTabBtn);
        headerBar.appendChild(registerTabBtn);
      }
    }
    renderHeaderBar();

    // è¨»å†ŠåŠŸèƒ½
    document.getElementById('registerForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const username = this.reg_username.value;
      const password = this.reg_password.value;
      if (!username || !password) {
        alert('è«‹è¼¸å…¥å¸³è™Ÿå’Œå¯†ç¢¼');
        return;
      }
      fetch('/addUser', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password_hash: password })
      })
        .then(res => res.json())
        .then(result => {
          if (result.success) {
            alert('è¨»å†ŠæˆåŠŸï¼');
            this.reset();
            // è¨»å†Šå¾Œè‡ªå‹•åˆ‡æ›åˆ°ç™»å…¥åˆ†é 
            renderHeaderBar();
            document.getElementById('loginTab').classList.add('active');
            document.getElementById('registerTab').classList.remove('active');
            document.querySelector('.tab-btn.active').classList.remove('active');
            document.querySelectorAll('.tab-btn')[0].classList.add('active');
          } else {
            alert('è¨»å†Šå¤±æ•—ï¼š' + (result.message || 'æœªçŸ¥éŒ¯èª¤'));
          }
        });
    });

    // ç™»å…¥åŠŸèƒ½
    document.getElementById('loginForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const username = this.login_username.value;
      const password = this.login_password.value;
      if (!username || !password) {
        alert('è«‹è¼¸å…¥å¸³è™Ÿå’Œå¯†ç¢¼');
        return;
      }
      fetch('/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      })
        .then(res => res.json())
        .then(result => {
          if (result.success) {
            // é€™è£¡è¦åŒæ™‚å­˜ is_admin
            localStorage.setItem('user_id', result.user_id);
            localStorage.setItem('username', result.username);
            localStorage.setItem('is_admin', result.is_admin ? '1' : '0');
            alert('ç™»å…¥æˆåŠŸï¼');
            renderHeaderBar();
            document.getElementById('loginTab').classList.remove('active');
            document.getElementById('registerTab').classList.remove('active');
            // é¡¯ç¤ºç®¡ç†å“¡å¾Œå°æŒ‰éˆ•ï¼ˆå¦‚æœæ˜¯ç®¡ç†å“¡ï¼‰
            if (result.is_admin) {
              let adminBtn = document.querySelector('.big-options .admin-btn');
              if (!adminBtn) {
                adminBtn = document.createElement('a');
                adminBtn.href = 'admin.html';
                adminBtn.textContent = 'ç®¡ç†å“¡å¾Œå°';
                adminBtn.className = 'big-option-btn admin-btn';
                document.querySelector('.big-options').appendChild(adminBtn);
              }
            }
          } else {
            alert('ç™»å…¥å¤±æ•—ï¼š' + (result.message || 'æœªçŸ¥éŒ¯èª¤'));
          }
        });
    });

    // é é¢è¼‰å…¥æ™‚ï¼Œå¦‚æœå·²ç™»å…¥ä¸”æ˜¯ç®¡ç†å“¡ï¼Œé¡¯ç¤ºç®¡ç†å“¡å¾Œå°æŒ‰éˆ•
    if (localStorage.getItem('is_admin') === '1') {
      let adminBtn = document.querySelector('.big-options .admin-btn');
      if (!adminBtn) {
        adminBtn = document.createElement('a');
        adminBtn.href = 'admin.html';
        adminBtn.textContent = 'ç®¡ç†å“¡å¾Œå°';
        adminBtn.className = 'big-option-btn admin-btn';
        document.querySelector('.big-options').appendChild(adminBtn);
      }
    }
  </script>
</body>

</html>